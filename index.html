<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <link rel="stylesheet" href="style.css">
    </head>
    
    <body style="margin: 0; overflow: hidden;">
        <div class="container">
            <div id="info"><h1>Sample</h1></div>
            <div id="product-info-container">
                <div id="product-info"></div>
            </div>
            <button id="button" class="btn btn__primary"><span>Scan Marker</span></button>
            <div class="bottom">
                <div class="navigation" id="navigation">
                    <button id="previousBtn" class="btn btn__primary"><span>Previous</span></button>
                    <button id="nextBtn" class="btn btn__primary"><span>Next</span></button>
                </div>
            </div>
            <button id="exit" class="exit btn__exit"><span>Exit</span></button>
            <select name="Language" id="lang" class="select btn__primary">
                <option value="en">English</option>
                <option value="zh">Chinese</option>
            </select>
        </div>
    
        <a-scene
            vr-mode-ui="enabled: false;"
            loading-screen="enabled: false;"
            renderer="logarithmicDepthBuffer: true;"
            arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
            embedded
        >
        </a-scene>
    
        <script>
            const info = document.querySelector("#info");
            const exit = document.querySelector("#exit");
            const product_Info = document.querySelector("#product-info");
            const previousBtn = document.querySelector("#previousBtn");
            const nextBtn = document.querySelector("#nextBtn");
            const langSelect = document.querySelector("#lang");
            
            info.style.display = "none";
            lang.style.display = "none";
            previousBtn.style.display = "none";
            nextBtn.style.display = "none";
            product_Info.style.display = "none";
            exit.style.display = "none";
            
            let selectedLanguage = "en"; // Default language is English.
            let markerDetected = false; // Flag to track if the marker is detected.
            
            function fetchContentFile(contentFiles, selectedLanguage) {
                const contentFile = contentFiles[selectedLanguage];
                return fetch(contentFile)
                    .then((response) => response.text())
                    .catch((error) => {
                        console.error("Error fetching content file:", error);
                        return "";
                    });
            }
            
            function updateProductInfo(content) {
                product_Info.innerHTML = content;
            }
            
            function fetchMarkerData() {
                return fetch("contents/content.json")
                    .then((response) => response.json())
                    .catch((error) => {
                        console.error("Error fetching marker data:", error);
                        return [];
                    });
            }
            
            fetchMarkerData().then((markers) => {
                const scene = document.querySelector("a-scene");
            
                function showContent(selectedLanguage) {
                    fetchContentFile(markers[0].contentFiles, selectedLanguage).then((content) => {
                        updateProductInfo(content);
                    });
                }
            
                langSelect.addEventListener("change", () => {
                    selectedLanguage = langSelect.value;
                    showContent(selectedLanguage);
                });
            
                exit.addEventListener("click", () => {
                    if (markerDetected) {
                        markerDetected = false;
                        info.style.display = "none";
                        lang.style.display = "none";
                        previousBtn.style.display = "none";
                        nextBtn.style.display = "none";
                        product_Info.style.display = "none";
                        exit.style.display = "none";
                        button.style.display = "block";
                    }
                });
            
                const marker = markers[0]; // Assuming there's only one marker in the "markers" array.
                const markerEl = document.createElement("a-marker");
                markerEl.setAttribute("type", "pattern");
                markerEl.setAttribute("url", marker.patternUrl);
            
                const modelEl = document.createElement("a-entity");
                modelEl.setAttribute("gltf-model", marker.modelUrl);
                modelEl.setAttribute("position", "0 -2 -1");
                modelEl.setAttribute("scale", "0.5 0.5 0.5");
                modelEl.setAttribute("rotation", "-90 -90 90");
            
                markerEl.addEventListener("markerFound", () => {
                    if (!markerDetected) {
                        markerDetected = true;
                        info.textContent = marker.info;
                        info.style.display = "block";
                        lang.style.display = "block";
                        previousBtn.style.display = "block";
                        nextBtn.style.display = "block";
                        exit.style.display = "block";
                        product_Info.style.display = "block";
                        showContent(selectedLanguage); // Load content based on selected language.
            
                        button.style.display = "none";
                        scene.appendChild(markerEl);
                    }
                });
            
                scene.appendChild(markerEl);
            });
        </script>          
    </body>
</html>
